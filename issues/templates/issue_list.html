
{% extends 'base.html' %}

{% block content %}

<div class="master" style>
    <div class = "wrapper issues lightbox-generic-form">
        <div class="main issue-main">
            <div class="issue-top">
                <header class="issue-header">
                    <h1>
                        <span>Issues</span>
                    </h1>
                    <div class="taskboard-actions">
                        <div class="issue-table-options-start" >
                            <button class="btn-filter" onclick="myFunction()">
                                <i class="fa fa-sliders" aria-hidden="true"></i>
                                
                                <span class="text" style="margin: 5px;">Filtres</span>
                            </button>
                            <div>
                                <input class="ng-pristine ng-valid ng-empty ng-touched">
                            </div>
                            
                        </div>
                        <div class="new-issue">
                            <button class="btn-small" >
                                <span class="icon icon-add" style="font-size: large;padding-right: 5px;">+</span>
                                <a href="/issues/create/" > New Issue</a>
                            </button>
                            
                            <button class="btn-icon" >
                                
                                    <a href="/issues/bulk/" >
                                        <i class="fa fa-plus" aria-hidden="true"></i>  
                                    </a> 

                                
                                
                            </button>
                        </div>
                        
                    </div>
                </header>
            </div>
            <div class="issue-container">
                
                <sidebar class="filters-bar" id="filtres"  >
                    <div>
                        <div class="filters-step-cat">
                           
                            <div class="filters-cat">
                                <div class="filters-applied">
                                    <div class="filters-included">
                                        <div class="filters-title">Filtrat per:</div>
                                        <div class="filters-wrapper">
                                            {%for key,value in TTipus%}
                                            {% if "tipus="|add:key in request.get_full_path %}
                                            <div class="single-applied-filter ng-animate-disabled include" id="bug_select">
                                                <div class="name">{{value}}</div>
                                               
                                                <p>{{patata}}</p>
                                                <p>{{potota}}</p>
                                                    <a href="" class="name">X</a>
                                               
                                                
                                            </div>
                                            {%endif%}
                                            {%endfor%}
                                            
                                            {%for key,value in TGravetat%}
                                            {% if "gravetat="|add:key in request.get_full_path %}
                                            <div class="single-applied-filter ng-animate-disabled include" id="bug_select">
                                                <div class="name">{{value}}</div>
                                                    <a href="?gravetat=" class="name"onclick="filtrat('bug')">X</a>
                                            </div>
                                            {%endif%}
                                            {%endfor%}
                                            
                                            {%for key,value in TPrioritat%}
                                            {% if "prioritat="|add:key in request.get_full_path %}
                                            <div class="single-applied-filter ng-animate-disabled include" id="bug_select">
                                                    <div class="name">{{value}}</div>
                                                    <a href="?prioritat=" class="name"onclick="filtrat('bug')">X</a>
                                            </div>
                                            {%endif%}
                                            {%endfor%}
                                            
                                            {%for key,value in TEstats%}
                                            {% if "estat="|add:key in request.get_full_path %}
                                            <div class="single-applied-filter ng-animate-disabled include" id="bug_select">
                                                    <div class="name">{{value}}</div>
                                                    <a href="?estat=" class="name">X</a>
                                            </div>
                                            {%endif%}
                                            {%endfor%}
                                            
                                            {%for usuari in usuaris%}
                                            {% if "assignat="|add:usuari.user.username in request.get_full_path %}
                                            <div class="single-applied-filter ng-animate-disabled include" id="bug_select">
                                                    <div class="name">{{usuari.user.username}}</div>
                                                    <a href="?assignat=" class="name">X</a>
                                            </div>
                                            {%endif%}
                                            {%endfor%}
                                            
                                            {%for tag in tags%}
                                            {% if "tag="|add:tag.nom in request.get_full_path %}
                                            <div class="single-applied-filter ng-animate-disabled include" id="bug_select">
                                                    <div class="name">{{tag.nom}}</div>
                                                    <a href="?estat=" class="name">X</a>
                                            </div>
                                            {%endif%}
                                            {%endfor%}
                                            
                                            {%for usuari in usuaris%}
                                            {% if "creat="|add:usuari.user.username in request.get_full_path %}
                                            <div class="single-applied-filter ng-animate-disabled include" id="bug_select">
                                                    <div class="name">{{usuari.user.username}}</div>
                                                    <a href="?creat=" class="name">X</a>
                                            </div>
                                            {%endif%}
                                            {%endfor%}
                                        </div>
                                    </div>
                                </div>
                                <ul>
                                    <li>
                                        <button class="filters-cat-single"  id="categoria_filtre_tipus" name = "obre"onclick="filtre_tipus('filtre_tipus')" style="display: flex">
                                            <span>Tipus</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-right" style="fill: block">
                                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                        </button>
                                        <button class="filters-cat-single selected" name="tanca"id="categoria_filtre_tipus_selected" onclick="filtre_tipus('filtre_tipus')" style="display: none">
                                            <span>Tipus</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-down" style="fill: cred">
                                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                            
                                        </button>
                                        <div class="filter-list" style="display:none"  name="tanca"  id="filtre_tipus" style="display:flex ; flex-direction: column";>
                                            <div>
                                                {%for key,value in TTipus%}
                                                    {%if key == 'B'%}
                                                        <button class="single-filter single-filter-type-general"style="border-color: rgb(228, 64, 87); width:100%" >
                                                    {%elif key == 'P'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(81, 120, 211)">
                                                    {%else%} 
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(64, 228, 206)">
                                                    {%endif%} 
                                                    {% if request.get_full_path != "/issues/" %}
                                                        <a href="{{request.get_full_path}}&tipus={{key}}" class="name">{{value}}</a>
                                                    {%else%}
                                                        <a href="?tipus={{key}}"class="name">{{value}}</a>
                                                    {%endif%}
                                                    <span class="number"></span>
                                                    </button>
                                                {%endfor%}
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <button class="filters-cat-single" id="categoria_filtre_gravetat" name = "obre"onclick="filtre_tipus('filtre_gravetat')">
                                            <span>Gravetat</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-right" style="fill: cred">
                                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                        </button>
                                        <button class="filters-cat-single selected" name="tanca"id="categoria_filtre_gravetat_selected" onclick="filtre_tipus('filtre_gravetat')" style="display:none">
                                            <span>Gravetat</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-down" style="fill: cred">
                                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                            
                                        </button>
                                        <div class="filter-list" style="display:none" name="tanca"id="filtre_gravetat">
                                            <div>
                                                {%for key,value in TGravetat%}
                                                    {%if key == 'D'%}
                                                        <button class="single-filter single-filter-type-general"style="border-color: rgb(112, 114, 143); width:100%">
                                                    {%elif key == 'M'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(64, 168, 228);">
                                                    {%elif key == 'N'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(64, 228, 124);">
                                                    {%elif key == 'I'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(228, 162, 64);">
                                                    {%else%} 
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(211, 84, 80);">
                                                    {%endif%} 
                                                    
                                                    {% if request.get_full_path != "/issues/" %}
                                                        <a href="{{request.get_full_path}}&gravetat={{key}}" class="name">{{value}}</a>
                                                    {%else%}
                                                        <a href="?gravetat={{key}}"class="name">{{value}}</a>
                                                    {%endif%}
                                                    <span class="number"></span>
                                                    </button>
                                                {%endfor%}  
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <button class="filters-cat-single" id="categoria_filtre_prioritat" name = "obre"onclick="filtre_tipus('filtre_prioritat')">
                                            <span>Prioritat</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-right" style="fill: cred">
                                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                        </button>
                                        <button class="filters-cat-single selected" name="tanca"id="categoria_filtre_prioritat_selected" onclick="filtre_tipus('filtre_prioritat')" style="display:none">
                                            <span>Prioritat</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-down" style="fill: cred">
                                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                            
                                        </button>
                                        <div class="filter-list" style="display:none" name="tanca"id="filtre_prioritat">
                                            <div>
                                                {%for key,value in TPrioritat%}
                                                    {%if key == 'B'%}
                                                        <button class="single-filter single-filter-type-general"style="border-color: rgb(168, 228, 64); width:100%">
                                                    {%elif key == 'M'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(228, 206, 64);">
                                                    {%else%} 
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(228, 124, 64);">
                                                    {%endif%} 
                                                    {% if request.get_full_path != "/issues/" %}
                                                        <a href="{{request.get_full_path}}&prioritat={{key}}" class="name">{{value}}</a>
                                                    {%else%}
                                                        <a href="?prioritat={{key}}"class="name">{{value}}</a>
                                                    {%endif%}
                                                    <span class="number"></span>
                                                    </button>
                                                {%endfor%}
                                                
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <button class="filters-cat-single" id="categoria_filtre_estat" name = "obre"onclick="filtre_tipus('filtre_estat')">
                                            <span>Estat</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-right" style="fill: cred">
                                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                        </button>
                                        <button class="filters-cat-single selected" name="tanca"id="categoria_filtre_estat_selected" onclick="filtre_tipus('filtre_estat')" style="display:none">
                                            <span>Estat</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-down" style="fill: cred">
                                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                            
                                        </button>
                                        <div class="filter-list" style="display:none" name="tanca"id="filtre_estat">
                                            <div>
                                                {%for key,value in TEstats%}
                                                    {%if key == 'N'%}
                                                        <button class="single-filter single-filter-type-general"style="border-color: rgb(112, 114, 143);; width:100%">
                                                    {%elif key == 'D'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(64, 168, 228);">
                                                    {%elif key == 'T'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(228, 206, 64);">
                                                    {%elif key == 'C'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(168, 228, 64);">
                                                    {%elif key == 'I'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(228, 64, 87);">
                                                    {%elif key == 'R'%}
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(169, 170, 188);">
                                                    {%else%} 
                                                        <button class="single-filter single-filter-type-general" style="border-color: rgb(81, 120, 211);">
                                                    {%endif%} 
                                                    
                                                    {% if request.get_full_path != "/issues/" %}
                                                        <a href="{{request.get_full_path}}&estat={{key}}" class="name">{{value}}</a>
                                                    {%else%}
                                                        <a href="?estat={{key}}"class="name">{{value}}</a>
                                                    {%endif%}
                                                    <span class="number"></span>
                                                    </button>
                                                {%endfor%}
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <button class="filters-cat-single" id="categoria_filtre_assignat" name = "obre"onclick="filtre_tipus('filtre_assignat')">
                                            <span>Assignat a</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-right" style="fill: cred">
                                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                        </button>
                                        <button class="filters-cat-single selected" name="tanca"id="categoria_filtre_assignat_selected" onclick="filtre_tipus('filtre_assignat')" style="display:none">
                                            <span>Assignat a</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-down" style="fill: cred">
                                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                        </button>
                                        <div class="filter-list" style="display:none" name="tanca"id="filtre_assignat">
                                            <div>
                                                {%for usuari in usuaris%}
                                                <button class="single-filter single-filter-type-general" style="border-color: rgb(81, 120, 211);">
                                                    <a href="{{request.get_full_path}}&assignat={{usuari.user.username}}" class="name">{{usuari.user.username}}</a>
                                                </button>
                                                
                                                {%endfor%}
                                            </div>
                                            
                                        </div>
                                    </li>
                                    <li>
                                        <button class="filters-cat-single" id="categoria_filtre_rol" name = "obre"onclick="filtre_tipus('filtre_rol')">
                                            <span>Tags</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-right" style="fill: cred">
                                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                        </button>
                                        <button class="filters-cat-single selected" name="tanca"id="categoria_filtre_rol_selected" onclick="filtre_tipus('filtre_rol')" style="display:none">
                                            <span>Tags</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-down" style="fill: cred">
                                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                            
                                        </button>
                                        <div class="filter-list" style="display:none" name="tanca"id="filtre_rol">
                                            <div>
                                                {%for tag in tags%}
                                                <button class="single-filter single-filter-type-general" style="border-color:'tag.color';">
                                                    <a href="{{request.get_full_path}}&creat={{tag.nom}}" class="name">{{tag.nom}}</a>
                                                </button>
                                                
                                                {%endfor%}
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <button class="filters-cat-single" id="categoria_filtre_creat" name = "obre"onclick="filtre_tipus('filtre_creat')">
                                            <span>Creat per</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-right" style="fill: cred">
                                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                        </button>
                                        <button class="filters-cat-single selected" name="tanca"id="categoria_filtre_creat_selected" onclick="filtre_tipus('filtre_creat')" style="display:none">
                                            <span>Creat per</span>
                                            <div class="ng-animate-disabled">
                                                <svg class="icon icon-arrow-down" style="fill: cred">
                                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                                </svg>
                                            </div>
                                            
                                        </button>
                                        <div class="filter-list" style="display:none" name="tanca"id="filtre_creat">
                                            <div>
                                                {%for usuari in usuaris%}
                                                <button class="single-filter single-filter-type-general" style="border-color: rgb(168, 228, 64);">
                                                    <a href="{{request.get_full_path}}&creat={{usuari.user.username}}" class="name">{{usuari.user.username}}</a>
                                                </button>
                                                
                                                {%endfor%}
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </sidebar>
                <div class="issue-page"style="width: 100%;">
                   <table class="issues-table" style="width: 100%;border-collapse:separate; border-spacing: 0 10px;">
                        <tr class="row title">
                            <td class="level-field" style="display:flex">
                                <span >Tipus</span>
                                    <div style="display:flex;flex-direction: column; padding-left: 10px; align-items: center;">
                                    <a href="?order_by=tipus" class="name">
                                        <img src="   https://cdn-icons-png.flaticon.com/512/130/130906.png " width="5" height="5" alt="" title="" class="img-small">
                                    </a>
                                    <a href="?order_by=-tipus" class="name">
                                        <img src="   https://cdn-icons-png.flaticon.com/512/2985/2985150.png " width="7" height="7" alt="" title="" class="img-small">
                                    </a>
                                </div>
                                  
                                
                            </td>
                            <td class="level-field">
                                <div>
                                <span >Gravetat</span>
                                <div style="display:flex;flex-direction: column; padding-left: 10px; align-items: center;">
                                    <a href="?order_by=gravetat" class="name">
                                        <img src="   https://cdn-icons-png.flaticon.com/512/130/130906.png " width="5" height="5" alt="" title="" class="img-small">
                                    </a>
                                    <a href="?order_by=-gravetat" class="name">
                                        <img src="   https://cdn-icons-png.flaticon.com/512/2985/2985150.png " width="7" height="7" alt="" title="" class="img-small">
                                    </a>
                                </div>
                                </div>
                            </td>
                            <td class="level-field">
                                <span class="wide">Prioritat</span>
                            </td>
                            <td class="subject">
                                <span class="wide">Issue</span>
                            </td>
                            <td class="issue-field"></td>
                            <td class="modified-field"></td>
                            <td class="assigned-field"></td>
                        </tr>
                        {% for issue in issues %}
                            <tr class="row table-main" style="height: 80px;">
                            
                                <td class="level-field" style="padding-left: 20px;padding-right: 20px; text-align: center;
                                vertical-align: middle">
                                        {% if issue.tipus == "B" %}
                                            <div class="level" style="background: rgb(228, 64, 87)"></div>
                                        {%elif issue.tipus == "P"%}
                                            <p class="level" style="background: rgb(81, 120, 211)"></p>
                                        {%elif issue.tipus == "M"%}
                                            <p class="level" style="background:  rgb(64, 228, 206)"></p>
                                        {%endif%}
                                      
                                </td>
                                
                                 <td class="level-field" style="padding-right: 20px;text-align: center;
                                 vertical-align: middle;">
                                    {% if issue.gravetat == "D" %}
                                        <div class="level" style="background: rgb(112, 114, 143)"></div>
                                    {%elif issue.gravetat == "M"%}
                                        <p class="level" style="background: rgb(64, 168, 228)"></p>
                                    {%elif issue.gravetat == "N"%}
                                        <p class="level" style="background:  rgb(64, 228, 124)"></p>
                                    {%elif issue.gravetat == "I"%}
                                        <p class="level" style="background:  rgb(228, 162, 64)"></p>
                                    {%elif issue.gravetat == "C"%}
                                        <p class="level" style="background:   rgb(211, 84, 80)"></p>
                                    {%endif%}
                                    
                                 </td>
                                 
                                 <td class="level-field" style="padding-right: 20px;text-align: center;
                                 vertical-align: middle;">
                                        {% if issue.prioritat == "B" %}
                                            <p class="level" style="background: rgb(168, 228, 64);"></p>
                                        {%elif issue.prioritat == "M"%}
                                            <p class="level" style=" background: rgb(228, 206, 64);;"></p>
                                        {%elif issue.prioritat == "A"%}
                                            <p class="level" style="background:  rgb(228, 124, 64);"></p>
                                        {%endif%}
                                </td>
                            
                                <td class="subject" style="text-align: center;
                                vertical-align: middle;">
                                    
                                    <a href="/issues/{{issue.id}}/edit" >
                                        <span classe="issue-text" style="display: inline-flex;">
                                            <span class="issue-ref">#{{issue.id}}</span>
                                            <span class="issue-subject">{{issue.subject}}</span>
                                            
                                        </span>
                                        
                                    </a> 
                                </td>
                                
                                <td style="text-align: center;
                                vertical-align: middle;">
                                    <div class="assigned-field" >
                                    
                                    {%if issue.estat == 'C'%}
                                        <span style="color:#70b578">{{issue.get_estat_display}}</span>
                                    {%elif issue.estat == 'R'%}
                                        <span style="color:#FF0000">{{issue.get_estat_display}}</span>
                                    {%else %}
                                        <span>{{issue.get_estat_display}}</span>
                                    {%endif%} 
                                    </div>
                                </td>
                                
                                <td class="modified-field" style="text-align: center;
                                vertical-align: middle;">
                                    <span>{{issue.dataModificacio}}</span>
                                    
                                </td>
                                
                                <td class="assigned-field" style="text-align: center;
                                vertical-align: middle;">   
                                    <span class="issue-assignedto">{{issue.assignacio.user.username}}</span>
                                </td>
                                
                            </tr> 
                        {% endfor %}

                    </table>
                </div>
            </div>
</div>
</div>

    
<script type="text/javascript">
    
    function borra(key) {
        console.log(window.location)
        window.location = window.location.delete(key);
    }
    
    function myFunction() {
        var x = document.getElementById("filtres");
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
         x.style.display = "none";
        }
    }

    function tanca_tot(param1){
        var tanca = document.getElementsByName("tanca");
        for(var i = 0; i < tanca.length; i++){
            if(tanca[i].id != param1)
            tanca[i].style.display= "none"; 
        }
        var obre = document.getElementsByName("obre");
        for(var i = 0; i < obre.length; i++){
            if(obre[i].id != param1)
            obre[i].style.display= "flex"; 
        }
    }

    function filtre_tipus(param1) {
        if(param1 == "filtre_tipus"){
            var x = document.getElementById("filtre_tipus");
            var y = document.getElementById("categoria_filtre_tipus");
            var z = document.getElementById("categoria_filtre_tipus_selected")
        }
        if(param1 == "filtre_gravetat"){
            var x = document.getElementById("filtre_gravetat");
            var y = document.getElementById("categoria_filtre_gravetat");
            var z = document.getElementById("categoria_filtre_gravetat_selected")
        }
        if(param1 == "filtre_prioritat"){
            var x = document.getElementById("filtre_prioritat");
            var y = document.getElementById("categoria_filtre_prioritat");
            var z = document.getElementById("categoria_filtre_prioritat_selected")
        }
        if(param1 == "filtre_estat"){
            var x = document.getElementById("filtre_estat");
            var y = document.getElementById("categoria_filtre_estat");
            var z = document.getElementById("categoria_filtre_estat_selected")
        }
        if(param1 == "filtre_assignat"){
            var x = document.getElementById("filtre_assignat");
            var y = document.getElementById("categoria_filtre_assignat");
            var z = document.getElementById("categoria_filtre_assignat_selected")
        }
        if(param1 == "filtre_rol"){
            var x = document.getElementById("filtre_rol");
            var y = document.getElementById("categoria_filtre_rol");
            var z = document.getElementById("categoria_filtre_rol_selected")
        }
        if(param1 == "filtre_creat"){
            var x = document.getElementById("filtre_creat");
            var y = document.getElementById("categoria_filtre_creat");
            var z = document.getElementById("categoria_filtre_creat_selected")
        }

      
        if (y.style.display === "none") {
            tanca_tot(param1);
            x.style.display = "none";
            y.style.display = "flex";
            z.style.display = "none";
        } else {
            tanca_tot(param1);
            x.style.display = "flex";
            y.style.display = "none";
            z.style.display = "flex";
        }
    }
</script>

{% endblock %}